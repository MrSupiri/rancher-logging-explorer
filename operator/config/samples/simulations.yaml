apiVersion: v1
kind: Pod
metadata:
  name: busybox-echo
  labels:
    loggingplumber.isala.me/test: simulations
spec:
  containers:
    - name: busybox
      image: busybox
      command: ["sh", "-c", 'x=1; while [ $x -gt -1 ]; do echo "Test" $(( x++ )) && sleep 10; done']
---
apiVersion: logging.banzaicloud.io/v1beta1
kind: Flow
metadata:
  name: busybox-echo
  labels:
    loggingplumber.isala.me/test: simulations
spec:
  localOutputRefs:
    - busybox-echo
  match:
    - select:
        labels:
          loggingplumber.isala.me/test: simulations
#    - select:
#        labels:
#          app.kubernetes.io/something: b
#    - select:
#        labels:
#          app.kubernetes.io/someotherthing: c
---
apiVersion: logging.banzaicloud.io/v1beta1
kind: Output
metadata:
  name: busybox-echo
  labels:
    loggingplumber.isala.me/test: simulations
spec:
  http:
    endpoint: "http://logging-plumber-log-aggregator.svc/busybox-echo"
    buffer:
      flush_interval: 10s
      flush_mode: interval
---
apiVersion: v1
kind: Service
metadata:
  name: logging-plumber-log-aggregator
  labels:
    loggingplumber.isala.me/test: simulations
spec:
  type: ClusterIP
  ports:
    - port: 80
      targetPort: http
      protocol: TCP
      name: http
  selector:
    app.kubernetes.io/name: logging-plumber-log-aggregator
    app.kubernetes.io/managed-by: rancher-logging-explorer
    app.kubernetes.io/created-by: logging-plumber
    loggingplumber.isala.me/component: log-aggregator